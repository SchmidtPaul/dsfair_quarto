{
  "hash": "507dbc467f2171191747981d5a45a7a1",
  "result": {
    "markdown": "---\ntitle: \"One-way completely randomized design\"\nabstract: \"One-way ANOVA & pairwise comparison post hoc tests in a completely randmoized design.\"\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# (install &) load packages\npacman::p_load(\n  conflicted,\n  desplot,\n  emmeans,\n  ggtext,\n  multcomp,\n  multcompView,\n  tidyverse)\n\n# handle function conflicts\nconflict_prefer(\"filter\", \"dplyr\") \nconflict_prefer(\"select\", \"dplyr\")\n```\n:::\n\n\n# Data\n\nThis example is taken from *\"Example 4.3\"* of the course material \"Quantitative Methods in Biosciences (3402-420)\" by [Prof. Dr. Hans-Peter Piepho](https://www.uni-hohenheim.de/organisation?tx_base_lsfcontentadmin%5BlsfPerson%5D=6257). It considers data published on p.52 of @mead2002 from a yield trial with melons. The trial had 4 melon varieties (`variety`). Each variety was tested on six field plots. The allocation of treatments (varieties) to experimental units (plots) was completely at random. Thus, the experiment was laid out as a completely randomized design (CRD).\n\n## Import\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```{.custom-output}\n# data is available online:\npath <- \"https://raw.githubusercontent.com/SchmidtPaul/dsfair_quarto/master/data/Mead1993.csv\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- read_csv(path) # use path from above\ndat\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.custom-output}\n# A tibble: 24 × 4\n   variety yield   row   col\n   <chr>   <dbl> <dbl> <dbl>\n 1 v1       25.1     4     2\n 2 v1       17.2     1     6\n 3 v1       26.4     4     1\n 4 v1       16.1     1     4\n 5 v1       22.2     1     2\n 6 v1       15.9     2     4\n 7 v2       40.2     4     4\n 8 v2       35.2     3     1\n 9 v2       32.0     4     6\n10 v2       36.5     2     1\n# … with 14 more rows\n```\n:::\n:::\n\n\n## Format\n\nBefore anything, the column `variety` should be encoded as a factor, since R by default encoded it as a character variable. There are multiple ways to do this - here are two:\n\n::: columns\n::: {.column width=\"49%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- dat %>% \n  mutate(variety = as.factor(variety))\n```\n:::\n\n:::\n\n::: {.column width=\"2%\"}\n:::\n\n::: {.column width=\"49%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- dat %>% \n  mutate(across(variety, ~ as.factor(.x)))\n```\n:::\n\n:::\n:::\n\n## Explore\n\nWe make use of [`dlookr::describe()`](../../summaryarticles/usefulthings.qmd#dlookr) to conveniently obtain descriptive summary tables. Here, we get can summarize per variety.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% \n  group_by(variety) %>% \n  dlookr::describe(yield) %>% \n  select(2:sd, p00, p100) %>%\n  arrange(desc(mean))\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.custom-output}\n# A tibble: 4 × 7\n  variety     n    na  mean    sd   p00  p100\n  <fct>   <int> <int> <dbl> <dbl> <dbl> <dbl>\n1 v2          6     0  37.4  3.95  32.0  43.3\n2 v4          6     0  29.9  2.23  27.6  33.2\n3 v1          6     0  20.5  4.69  15.9  26.4\n4 v3          6     0  19.5  5.56  11.4  25.9\n```\n:::\n:::\n\n\nAdditionally, we can decide to plot our data:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot(data = dat) +\n  aes(y = yield, x = variety) +\n  geom_point() +\n  scale_x_discrete(\n    name = \"Variety\"\n  ) +\n  scale_y_continuous(\n    name = \"Yield\",\n    limits = c(0, NA),\n    expand = expansion(mult = c(0, 0.1))\n  ) +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](crd_mead1993_files/figure-html/unnamed-chunk-8-1.png){width=1650}\n:::\n:::\n\n\nFinally, since this is an experiment that was laid with a certain experimental design (= a completely randomized design; CRD) - it makes sense to also get a field plan. This can be done via `desplot()` from [{desplot}](../../summaryarticles/usefulthings.qmd#desplot):\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndesplot(\n  data = dat, \n  flip = TRUE, # row 1 on top, not on bottom\n  form = variety ~ col + row, # fill color per variety\n  text = variety, # variety names per plot\n  cex = 1, # variety names: font size\n  shorten = \"no\", # variety names: don't abbreviate\n  main = \"Field layout\", # plot title\n  show.key = FALSE # hide legend \n  )     \n```\n\n::: {.cell-output-display}\n![](crd_mead1993_files/figure-html/unnamed-chunk-9-1.png){width=1650}\n:::\n:::\n\n\n# Model\n\nFinally, we can decide to fit a linear model with `yield` as the response variable and (fixed) `variety` effects.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- lm(yield ~ variety, data = dat)\n```\n:::\n\n\n::: custom-callout-modass\nIt would be at this moment (i.e. after fitting the model and before running the ANOVA), that you should check whether the model assumptions are met. Find out more in the [summary article \"Model Diagnostics\"](../../summaryarticles/modeldiagnostics.qmd)\n:::\n\n# ANOVA\n\nBased on our model, we can then conduct an ANOVA:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nANOVA <- anova(mod)\nANOVA\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.custom-output}\nAnalysis of Variance Table\n\nResponse: yield\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \nvariety    3 1291.48  430.49  23.418 9.439e-07 ***\nResiduals 20  367.65   18.38                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nAccordingly, the ANOVA's F-test found the variety effects to be statistically different (p < .001***).\n\n# Mean comparison\n\nBesides an ANOVA, one may also want to compare adjusted yield means between varieties via post hoc tests (t-test, Tukey test etc.).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean_comp <- mod %>% \n  emmeans(specs = ~ variety) %>% # adj. mean per variety\n  cld(Letters = letters) # compact letter display (CLD)\n\nmean_comp\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.custom-output}\n variety emmean   SE df lower.CL upper.CL .group\n v3        19.5 1.75 20     15.8     23.1  a    \n v1        20.5 1.75 20     16.8     24.1  a    \n v4        29.9 1.75 20     26.2     33.5   b   \n v2        37.4 1.75 20     33.8     41.1    c  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 4 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping letter,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n:::\n:::\n\n\nNote that if you would like to see the underlying individual contrasts/differences between adjusted means, simply add `details = TRUE` to the `cld()` statement. Furthermore, check out the [Summary Article \"Compact Letter Display\"](../../summaryarticles/compactletterdisplay.qmd).\n\nFinally, we can create a plot that displays both the raw data and the results, *i.e.* the comparisons of the adjusted means that are based on the linear model.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nmy_caption <- \"Black dots represent raw data. Red dots and error bars represent adjusted means with 95% confidence limits per variety. Means followed by a common letter are not significantly different according to the Tukey-test.\"\n\nggplot() +\n  aes(x = variety) +\n  # black dots representing the raw data\n  geom_point(\n    data = dat,\n    aes(y = yield)\n  ) +\n  # red dots representing the adjusted means\n  geom_point(\n    data = mean_comp,\n    aes(y = emmean),\n    color = \"red\",\n    position = position_nudge(x = 0.1)\n  ) +\n  # red error bars representing the confidence limits of the adjusted means\n  geom_errorbar(\n    data = mean_comp,\n    aes(ymin = lower.CL, ymax = upper.CL),\n    color = \"red\",\n    width = 0.1,\n    position = position_nudge(x = 0.1)\n  ) +\n  # red letters \n  geom_text(\n    data = mean_comp,\n    aes(y = emmean, label = str_trim(.group)),\n    color = \"red\",\n    position = position_nudge(x = 0.2),\n    hjust = 0\n  ) +\n  scale_x_discrete(\n    name = \"Variety\"\n  ) +\n  scale_y_continuous(\n    name = \"Yield\",\n    limits = c(0, NA),\n    expand = expansion(mult = c(0, 0.1))\n  ) +\n  theme_classic() +\n  labs(caption = my_caption) +\n  theme(plot.caption = element_textbox_simple(margin = margin(t = 5)),\n        plot.caption.position = \"plot\")\n```\n\n::: {.cell-output-display}\n![](crd_mead1993_files/figure-html/unnamed-chunk-13-1.png){width=1650}\n:::\n:::\n",
    "supporting": [
      "crd_mead1993_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}